/* olexp 0.1.0 (c) Daniel Pulido <dpmcmlxxvi@gmail.com> */
var olexp=olexp||{};!function(a){var b=function(b,c){if("undefined"==typeof b)throw new Error("olexp.Explorer: id not defined");if(0===$("#"+b).length)throw new Error("olexp.Explorer: id not found");var d="olexp-"+b;this.options={controls:{editsettings:!0,exportmap:!0,graticule:!0,layercontrol:!0,layermanager:!0,layermenu:!0,measure:!0,toolbarhide:!0},details:{hidden:!0,resizable:!0,size:"25%",type:"preview"},layers:{expanded:!0,group:!0,img:"icon-folder",text:"Layers"},map:{type:"main"},navigation:{resizable:!0,size:"15%",type:"left"},olcontrols:{fullscreen:!0,mouseposition:!0,overviewmap:!0,rotate:!0,scaleline:!0,zoom:!0,zoomslider:!0,zoomtoextent:!0},olinteractions:{draganddrop:!0},olmap:{controls:[],view:new ol.View({center:[0,0],zoom:3})},outline:{type:"main"},overlays:{expanded:!0,group:!0,img:"icon-folder",text:"Overlays"},settings:{},toolbar:{size:"40",style:"padding: 5px;",type:"top"}},$.extend(!0,this.options,c),$.extend(!0,this.options,{explorer:{cls:"olexp-explorer-content",id:d+"-explorer-id-content",details:d+"-explorer-name-details",layout:d+"-explorer-name-layout",navigation:d+"-explorer-name-navigation",outline:d+"-explorer-name-outline",toolbar:d+"-explorer-name-toolbar"},layers:{id:d+"-explorer-id-layers"},map:{content:'<div id="'+d+'-explorer-id-map" class="olexp-explorer-map"></div>'},olmap:{target:d+"-explorer-id-map"},overlays:{id:d+"-explorer-id-overlays"},settings:{prefix:d}});var e=this,f=$("<div>",{id:this.options.explorer.id,"class":this.options.explorer.cls});$("#"+b).append(f),this.layout=$("#"+this.options.explorer.id).w2layout({name:this.options.explorer.layout,panels:[this.options.navigation,this.options.map,this.options.toolbar]}),this.toolbar=$("").w2toolbar({name:this.options.explorer.toolbar}),this.navigation=$("").w2layout({name:this.options.explorer.navigation,onResize:function(){e.hasOwnProperty("map")&&e.map.updateSize(),e.hasOwnProperty("details")&&e.details.resize()},panels:[this.options.outline,this.options.details]}),this.outline=$("").w2sidebar({name:this.options.explorer.outline,nodes:[this.options.layers,this.options.overlays],onClick:function(a){var b=a.target,c=e.manager.getDetails(b);e.details.clear(),e.details.add(c),e.manager.onItemSelected(b)},onDblClick:function(a){var b=a.target;e.manager.toggleNode(b),e.manager.onItemSelected(b)},onRender:function(a){a.onComplete=function(){var a=e.outline.selected;e.manager.onItemSelected(a)}}}),this.details=$("").w2grid({columns:[{field:"property",caption:"Property",size:"100%",sortable:!0},{field:"value",caption:"Value",size:"100%",sortable:!0}],name:this.options.explorer.details}),this.navigation.content(this.options.outline.type,this.outline),this.navigation.content(this.options.details.type,this.details),this.layout.content(this.options.navigation.type,this.navigation),this.map=new ol.Map(this.options.olmap),this.manager=new a.manager.Manager(this.map,this.outline,this.details,this.options.layers.id,this.options.overlays.id);var g=a.menu.Zoom(this.manager,this.options.settings),h=a.menu.Properties(this.manager,this.options.settings),i=a.menu.Remove(this.manager,this.options.settings);this.menu={items:[],callbacks:{}},this.menu.items.push(g.menu),this.menu.items.push(h.menu),this.menu.items.push(i.menu),this.menu.callbacks[g.menu.id]=g.click,this.menu.callbacks[h.menu.id]=h.click,this.menu.callbacks[i.menu.id]=i.click,this.outline.menu=this.menu.items,this.outline.onMenuClick=function(a){var b=a.menuItem.id;b in e.menu.callbacks&&e.menu.callbacks[b](a)},this.util=new a.util.Util(this.options.settings);var j=this.util.getInteractions(this.map);for(var k in this.options.olinteractions){var l=j[k];this.options.olinteractions[k]&&this.map.addInteraction(l)}var m=this.util.getControls();for(var n in this.options.olcontrols){var o=m[n];this.map.addControl(o),o.setMap(this.options.olcontrols[n]?this.map:null)}this.selector=new a.selection.Feature(this.map,this.details),this.selector.setEnable(!0),this.api={details:this.details,layout:this.layout,manager:this.manager,map:this.map,navigation:this.navigation,options:this.options,outline:this.outline,toolbar:this.toolbar},this.options.controls.toolbarhide&&(this.toolbar.add(a.control.ToolbarHide(this.api,{hidden:this.options.toolbar.hidden,settings:this.options.settings})),this.toolbar.add({id:"break-toolbar-hide",type:"break"})),this.options.controls.layermanager&&(this.toolbar.add(a.control.LayerManager(this.api,this.manager,{details:{checked:!this.options.details.hidden},navigation:{checked:!this.options.navigation.hidden},settings:this.options.settings})),this.toolbar.add({id:"break-layer-manager",type:"break"})),this.options.controls.layermenu&&(this.toolbar.add(a.control.LayerMenu(this.api,this.manager,this.menu,{settings:this.options.settings})),this.toolbar.add({id:"break-item-menu",type:"break"})),this.options.controls.layercontrol&&(this.toolbar.add(a.control.LayerControl(this.api,{settings:this.options.settings})),this.toolbar.add({id:"break-layer-control",type:"break"})),this.options.controls.graticule&&(this.toolbar.add(a.control.Graticule(this.api,{settings:this.options.settings})),this.toolbar.add({id:"break-graticule",type:"break"})),this.options.controls.measure&&(this.toolbar.add(a.control.Measure(this.api,{settings:this.options.settings})),this.toolbar.add({id:"break-measure",type:"break"})),this.options.controls.exportmap&&(this.toolbar.add(a.control.ExportMap(this.api,{settings:this.options.settings})),this.toolbar.add({id:"break-export-map",type:"break"})),this.options.controls.editsettings&&(this.toolbar.add(a.control.EditSettings(this.api,{settings:this.options.settings})),this.toolbar.add({id:"break-edit-settings",type:"break"})),this.layout.set(this.options.toolbar.type,{content:"",show:{toolbar:!0},toolbar:this.toolbar})};a.destroy=function(a){void 0!==a.map&&a.map.setTarget(null),void 0!==a.details&&a.details.destroy(),void 0!==a.outline&&a.outline.destroy(),void 0!==a.navigation&&a.navigation.destroy(),void 0!==a.toolbar&&a.toolbar.destroy(),void 0!==a.layout&&a.layout.destroy()},a.Explorer=function(a,c){var d=new b(a,c);return d.api}}(olexp||{}),olexp.event=olexp.event||{},function(a){var b=function(a){this.listeners=$.extend({},a)};return b.prototype.on=function(a,b,c){if(a in this.listeners){var d=b;"undefined"!=typeof c&&(d=b.bind(c)),this.listeners[a].push(d)}},b.prototype.register=function(a){a in this.listeners||(this.listeners[a]=[])},b.prototype.trigger=function(){var a=Array.prototype.slice.call(arguments),b=a.shift();if(b in this.listeners)for(var c=0;c<this.listeners[b].length;c++)this.listeners[b][c].apply(this,a)},b.prototype.unregister=function(a){if(a in this.listeners){var b=this.listeners[a];return delete this.listeners[a],b}},b.prototype.off=function(a,b,c){if(a in this.listeners){var d=b;"undefined"!=typeof c&&(d=b.bind(c));var e=this.listeners[a].indexOf(d);e>-1&&this.listeners[a].splice(e,1)}},a.event.Event=function(a){var c=new b(a);return c},a}(olexp||{}),olexp.control=olexp.control||{},function(a){var b=function(a,b){var c=$.extend(!0,{control:{EditSettings:{form:{header:"",style:"border: 0px; background-color: transparent;"},hint:"Edit Controls",popup:{height:370,style:"width: 100%; height: 100%;",title:"Edit Controls",width:225},span:6}}},b);this.settings=c.control.EditSettings,this.button=b.prefix+"-control-edit-settings-button",this.icon="olexp-control-edit-settings",this.id=b.prefix+"-control-edit-settings-form",this.map=a,this.name=b.prefix+"-control-edit-settings-form"};return b.prototype.display=function(){var b=this,c=[{html:{caption:"Full Screen",span:this.settings.span},name:"fullscreen",type:"checkbox"},{html:{caption:"Mouse Position",span:this.settings.span},name:"mouseposition",type:"checkbox"},{html:{caption:"Overview Map",span:this.settings.span},name:"overviewmap",type:"checkbox"},{html:{caption:"Rotate",span:this.settings.span},name:"rotate",type:"checkbox"},{html:{caption:"Scale Line",span:this.settings.span},name:"scaleline",type:"checkbox"},{html:{caption:"Zoom",span:this.settings.span},name:"zoom",type:"checkbox"},{html:{caption:"Zoom Slider",span:this.settings.span},name:"zoomslider",type:"checkbox"},{html:{caption:"Zoom To Extent",span:this.settings.span},name:"zoomtoextent",type:"checkbox"}],d={fullscreen:this.isControlActive("fullscreen"),mouseposition:this.isControlActive("mouseposition"),overviewmap:this.isControlActive("overviewmap"),rotate:this.isControlActive("rotate"),scaleline:this.isControlActive("scaleline"),zoom:this.isControlActive("zoom"),zoomslider:this.isControlActive("zoomslider"),zoomtoextent:this.isControlActive("zoomtoextent")},e=function(a){for(var c in a){var d=a[c];b.setControl(c,d)}},f=$.extend(this.settings.form,{fields:c,name:this.name,record:d}),g=this.settings.popup;a.util.popup(this.id,e,f,g)},b.prototype.getControl=function(a){for(var b=this.map.getControls().getArray(),c=0;c<b.length;c++){var d=b[c];if("fullscreen"===a&&d instanceof ol.control.FullScreen)return d;if("mouseposition"===a&&d instanceof ol.control.MousePosition)return d;if("overviewmap"===a&&d instanceof ol.control.OverviewMap)return d;if("rotate"===a&&d instanceof ol.control.Rotate)return d;if("scaleline"===a&&d instanceof ol.control.ScaleLine)return d;if("zoom"===a&&d instanceof ol.control.Zoom)return d;if("zoomslider"===a&&d instanceof ol.control.ZoomSlider)return d;if("zoomtoextent"===a&&d instanceof ol.control.ZoomToExtent)return d}return null},b.prototype.isControlActive=function(a){var b=this.getControl(a);return null!==b&&null!==b.getMap()},b.prototype.setControl=function(a,b){var c=this.getControl(a);if(null!==c){var d=b?this.map:null;c.setMap(d)}},a.control.EditSettings=function(a,c){var d=new b(a.map,c.settings);return{hint:d.settings.hint,id:d.button,img:d.icon,onClick:function(a){d.display()},type:"button"}},a}(olexp||{}),function(a){var b=function(a,b){var c=$.extend(!0,{control:{ExportMap:{filename:"map.png",hint:"Export map"}}},b);this.settings=c.control.ExportMap,this.anchor=b.prefix+"-control-export-map-anchor",this.button=b.prefix+"-control-export-map-button",this.filename=this.settings.filename,this.icon="olexp-control-export-map",this.map=a};return b.prototype.toImage=function(){var a=this.anchor,b=this.filename,c=function(a){this.map.once("postcompose",function(a){d.href=a.context.canvas.toDataURL("image/png")}),this.map.renderSync()};$("body").append('<a id="'+a+'" download="'+b+'"></a>');var d=document.getElementById(a);d.addEventListener("click",c.bind(this),!1),$("#"+a)[0].click(),$("#"+a).remove()},a.control.ExportMap=function(a,c){var d=new b(a.map,c.settings);return{hint:d.settings.hint,id:d.button,img:d.icon,onClick:function(a){d.toImage()},type:"button"}},a}(olexp||{}),function(a){var b=function(b,c){var d=$.extend(!0,{control:{Graticule:{enable:!1,form:{header:"",style:"border: 0px; background-color: transparent;"},hint:"Edit Grid Lines",options:{color:"000000",lineDash:[.5,4],width:2},popup:{height:225,style:"border: 0px; background-color: transparent;",title:"Edit Grid Lines",width:300},span:3}}},c);this.settings=d.control.Graticule,this.button=c.prefix+"-control-graticule-button",this.icon="olexp-control-graticule",this.id=c.prefix+"-control-graticule",this.map=b,this.name=c.prefix+"-control-graticule-form",this.util=new a.util.Util(d),this.graticule=this.util.getGraticule(this.settings.enable?this.map:null,$.extend({},this.settings.options))};return b.prototype.display=function(){var b=this,c=[{html:{caption:"Enable",span:this.settings.span},name:"enable",required:!0,type:"checkbox"},{html:{caption:"Color",span:this.settings.span},name:"color",options:{silent:!1},required:!0,type:"color"},{html:{caption:"Width",span:this.settings.span},name:"width",options:{arrows:!0,max:4,min:.25,placeholder:"0.25 - 4",silent:!1,step:.25},required:!0,type:"float"}],d=this.graticule.olexp_record,e=function(a){for(var c in a)d[c]=a[c];var e=$.extend({},d);delete e.enable,b.graticule.setMap(null),b.graticule=b.util.getGraticule(d.enable?b.map:null,e)},f=$.extend(this.settings.form,{fields:c,name:this.name,record:d}),g=this.settings.popup;a.util.popup(this.id,e,f,g)},a.control.Graticule=function(a,c){"undefined"==typeof c&&(c={}),"undefined"==typeof c.settings&&(c.settings={});var d=new b(a.map,c.settings);return{hint:d.settings.hint,id:d.button,img:d.icon,onClick:function(a){d.display()},type:"button"}},a}(olexp||{}),function(a){var b=function(b,c){var d=$.extend(!0,{control:{LayerControlTile:{form:{header:"",style:"border: 0px; background-color: transparent;"},hint:"Add Tile Layer",popup:{height:175,style:"border: 0px; background-color: transparent;",title:"Add Tile Layer",width:285},span:3},LayerControlVector:{form:{header:"File Types: "+$.map(a.util.FileTypes,function(a){return" "+a.name}),style:"border: 0px; background-color: transparent;"},hint:"Add Vector Layer",popup:{height:195,style:"border: 0px; background-color: transparent;",title:"Add Vector Layer",width:350},span:4}}},c);this.settingsTile=d.control.LayerControlTile,this.settingsVector=d.control.LayerControlVector,this.icons={tile:"olexp-control-layer-control-add-tile",vector:"olexp-control-layer-control-add-vector"},this.buttons={tile:c.prefix+"-control-layer-control-add-tile-button",vector:c.prefix+"-control-layer-control-add-vector-button"},this.ids={tile:c.prefix+"-control-layer-control-add-tile",vector:c.prefix+"-control-layer-control-add-vector"},this.map=b,this.names={tile:c.prefix+"-control-tile-form",vector:c.prefix+"-control-vector-form"},this.util=new a.util.Util(this.map)};return b.prototype.tile=function(){var b=this,c=this.util.getTileTypes(),d=$.map(c,function(a){return a.name}),e=[{field:"tile_source",html:{caption:"Source",span:this.settingsTile.span},options:{items:d},required:!0,type:"list"}],f={};f[e[0].field]=null;var g=function(a){for(var d in a)if(d===e[0].field){var f=a[d].id;for(var g in c)if(f===c[g].name){var h=c[g],i=h["class"],j=new ol.layer.Tile({source:new i(h.settings)});j.set("name",f),b.map.addLayer(j)}}},h=$.extend(this.settingsTile.form,{fields:e,name:this.names.tile,record:f}),i=this.settingsTile.popup;a.util.popup(this.ids.tile,g,h,i)},b.prototype.vector=function(){var b=this,c=[{field:"vector_source",html:{caption:"Source",span:this.settingsVector.span},options:{placeholder:"Click to add file",silent:!1},required:!0,type:"file"}],d={};d[c[0].field]=null;var e=function(d){for(var e in d)if(e===c[0].field)for(var f in d[e]){var g=d[e][f].content;if("undefined"!=typeof g&&null!==g){var h=d[e][f].name,i=h.replace(/\.[^\/.]+$/,""),j=a.util.getReader(h);if(null===j)return void w2alert("Unable to open file "+h,"Error");var k=atob(g),l=b.map.getView().getProjection(),m={featureProjection:l},n=j.readFeatures(k,m);b.util.addLayerVector(b.map,i,n)}}},f=$.extend(this.settingsVector.form,{fields:c,name:this.names.vector,record:d}),g=this.settingsVector.popup;a.util.popup(this.ids.vector,e,f,g)},a.control.LayerControl=function(a,c){"undefined"==typeof c&&(c={}),"undefined"==typeof c.tile&&(c.tile=!0),"undefined"==typeof c.vector&&(c.vector=!0),"undefined"==typeof c.settings&&(c.settings={});var d=new b(a.map,c.settings),e=[];return c.tile&&e.push({hint:d.settingsTile.hint,id:d.buttons.tile,img:d.icons.tile,onClick:function(a){d.tile()},type:"button"}),c.vector&&e.push({hint:d.settingsVector.hint,id:d.buttons.vector,img:d.icons.vector,onClick:function(a){d.vector()},type:"button"}),e},a}(olexp||{}),olexp=function(a){var b=function(a,b,c){var d=$.extend(!0,{control:{LayerManager:{hintDetailsHide:"Hide details",hintDetailsShow:"Show details",hintMoveDown:"Move item down",hintMoveUp:"Move item up",hintOutlineHide:"Hide outline",hintOutlineShow:"Show outline"}}},c);this.buttons={details:c.prefix+"-control-layer-manager-button-details",down:c.prefix+"-control-layer-manager-button-down",navigation:c.prefix+"-control-layer-manager-button-navigation",up:c.prefix+"-control-layer-manager-button-up"},this.explorer=a,this.icons={details:"olexp-control-layer-manager-details",down:"olexp-control-layer-manager-down",navigation:"olexp-control-layer-manager-navigation",up:"olexp-control-layer-manager-up"},this.manager=b,this.settings=d.control.LayerManager,this.manager.on("remove:item",this.onItemRemoved,this),this.manager.on("select:item",this.onItemSelected,this)};return b.prototype.details=function(){this.explorer.navigation.toggle(this.explorer.options.details.type);var a=this.explorer.navigation.get(this.explorer.options.details.type),b=this.explorer.toolbar.get(this.buttons.details);b.hint=this.hintDetails(a.hidden),this.explorer.toolbar.refresh()},b.prototype.down=function(){this.manager.moveDown()},b.prototype.hintDetails=function(a){return a?this.settings.hintDetailsShow:this.settings.hintDetailsHide},b.prototype.hintNavigation=function(a){return a?this.settings.hintOutlineShow:this.settings.hintOutlineHide},b.prototype.navigation=function(){this.explorer.layout.toggle(this.explorer.options.navigation.type);var a=this.explorer.layout.get(this.explorer.options.navigation.type),b=this.explorer.toolbar.get(this.buttons.navigation);b.hint=this.hintNavigation(a.hidden),this.explorer.toolbar.refresh()},b.prototype.onItemRemoved=function(a){this.manager.isSelected(a.id)&&(this.explorer.toolbar.disable(this.buttons.up),this.explorer.toolbar.disable(this.buttons.down))},b.prototype.onItemSelected=function(a){if("undefined"!=typeof a){var b=this.manager.getById(a);if(null!==b){var c=this.manager.getNode(b.id);c.disabled?(this.explorer.toolbar.disable(this.buttons.up),this.explorer.toolbar.disable(this.buttons.down)):(this.explorer.toolbar.enable(this.buttons.up),this.explorer.toolbar.enable(this.buttons.down))}}},b.prototype.up=function(){this.manager.moveUp()},a.control.LayerManager=function(a,c,d){"undefined"==typeof d&&(d={}),"undefined"==typeof d.details&&(d.details={}),"undefined"==typeof d.details.enabled&&(d.details.enabled=!0),"undefined"==typeof d.details.checked&&(d.details.checked=!0),"undefined"==typeof d.down&&(d.down=!0),"undefined"==typeof d.navigation&&(d.navigation={}),"undefined"==typeof d.navigation.enabled&&(d.navigation.enabled=!0),"undefined"==typeof d.navigation.checked&&(d.navigation.checked=!0),"undefined"==typeof d.up&&(d.up=!0);var e=new b(a,c,d.settings),f=[];return d.navigation.enabled&&f.push({checked:d.navigation.checked,hint:e.hintNavigation(!d.navigation.checked),id:e.buttons.navigation,img:e.icons.navigation,onClick:function(a){e.navigation()},type:"check"}),d.details.enabled&&f.push({checked:d.details.checked,hint:e.hintDetails(!d.details.checked),id:e.buttons.details,img:e.icons.details,onClick:function(a){e.details()},type:"check"}),d.up&&f.push({disabled:!0,hint:e.settings.hintMoveUp,id:e.buttons.up,img:e.icons.up,onClick:function(a){e.up()},type:"button"}),d.down&&f.push({disabled:!0,hint:e.settings.hintMoveDown,id:e.buttons.down,img:e.icons.down,onClick:function(a){e.down()},type:"button"}),f},a}(olexp||{}),function(a){var b=function(a,b,c,d){var e=$.extend(!0,{control:{LayerMenu:{arrow:!0,hint:"Item Options",text:""}}},d);this.button=d.prefix+"-control-layer-menu",this.explorer=a,this.icon="olexp-control-layer-menu",this.manager=b,this.menu=c,this.settings=e.control.LayerMenu,this.manager.on("remove:item",this.onItemRemoved,this),this.manager.on("select:item",this.onItemSelected,this)};return b.prototype.onItemRemoved=function(a){this.manager.isSelected(a.id)&&this.explorer.toolbar.disable(this.button)},b.prototype.onItemSelected=function(a){if("undefined"!=typeof a){var b=this.manager.getById(a);if(null!==b){var c=this.manager.getNode(b.id);c.disabled?this.explorer.toolbar.disable(this.button):this.explorer.toolbar.enable(this.button)}}},a.control.LayerMenu=function(a,c,d,e){var f=new b(a,c,d,e.settings);return a.toolbar.on("click",function(b){if(null!==a.outline.selected){var c=f.button+":";if(!(b.target.indexOf(c)<0)){var e=b.target.replace(c,"");e in d.callbacks&&d.callbacks[e]({target:a.outline.selected})}}}),{arrow:f.settings.arrow,disabled:!0,hint:f.settings.hint,id:f.button,img:f.icon,items:f.menu.items,text:f.settings.text,type:"menu"}},a}(olexp||{}),function(a){var b=function(b,c){var d=$.extend(!0,{control:{Measurement:{hintArea:"Measure area",hintLength:"Measure length"}}},c);this.explorer=b,this.icons={area:"olexp-control-measure-area",length:"olexp-control-measure-length"},this.ids={area:c.prefix+"-control-measure-area-button",length:c.prefix+"-control-measure-length-button"},this.settings=d.control.Measurement,this.tool=new a.measure.Tool(b.map,a.measure.Type.LINE,c)};return b.prototype.area=function(){var b=!this.explorer.toolbar.get(this.ids.area).checked;this.measure(a.measure.Type.AREA,b)},b.prototype.length=function(){var b=!this.explorer.toolbar.get(this.ids.length).checked;this.measure(a.measure.Type.LINE,b)},b.prototype.measure=function(a,b){this.tool.setEnable(!1),b&&(this.tool.setType(a),this.tool.setEnable(!0))},a.control.Measure=function(a,c){"undefined"==typeof c&&(c={}),"undefined"==typeof c.area&&(c.area=!0),"undefined"==typeof c.length&&(c.length=!0),"undefined"==typeof c.settings&&(c.settings={});var d=new b(a,c.settings),e=[];return c.area&&e.push({hint:d.settings.hintArea,id:d.ids.area,img:d.icons.area,onClick:function(b){c.length&&a.toolbar.uncheck(d.ids.length),d.area()},type:"check"}),c.length&&e.push({hint:d.settings.hintLength,id:d.ids.length,img:d.icons.length,onClick:function(b){c.area&&a.toolbar.uncheck(d.ids.area),d.length()},type:"check"}),e},a}(olexp||{}),function(a){var b=function(b,c){var d=$.extend(!0,{control:{ToolbarHide:{hint:"Hide toolbar"}}},c.settings);this.button=c.settings.prefix+"-control-toolbar-hide-button",this.explorer=b,this.icon="olexp-control-toolbar-hide",this.settings=d.control.ToolbarHide,this.show=a.ol.ToolbarShow(this.explorer,c)};return b.prototype.hide=function(){this.explorer.layout.hide(this.explorer.options.toolbar.type),this.show.setMap(this.explorer.map)},a.control.ToolbarHide=function(a,c){var d=new b(a,c);return{hint:d.settings.hint,id:d.button,img:d.icon,onClick:function(a){d.hide()},type:"button"}},a}(olexp||{}),olexp.item=olexp.item||{},function(a){return a.item.icons={group:"olexp-item-group",heatmap:"olexp-item-heatmap",image:"olexp-item-image",overlay:"olexp-item-overlay",tile:"olexp-item-tile",vector:"olexp-item-vector"},Item=function(a,b,c){this.id=a,this.layer=c,this.moving=!1,this.name=b,this.type=Item.getType(this.layer),this.icon=Item.getIcon(this.type)},Item.prototype.getDetails=function(){var b={};b.Name=this.name;var c=this.layer.getProperties();if(c.hasOwnProperty(a.measure.properties.area)?b.Area=c[a.measure.properties.area]:c.hasOwnProperty(a.measure.properties.length)&&(b.Length=c[a.measure.properties.length]),this.type===a.item.Type.GROUP){var d=this.layer.getLayers();b["Layer Count"]=d.getLength()}if(this.type===a.item.Type.VECTOR){var e=this.layer.getSource(),f=e.getFeatures();b["Feature Count"]=f.length}var g=a.util.toRecords(b);return g},Item.prototype.getExtent=function(){if(this.type===a.item.Type.OVERLAY)return null;if(this.type===a.item.Type.GROUP){var b=null,c=this.layer.getLayers();return c.forEach(function(a,c,d){var e=Item.getLayerExtent(a);null===b&&null!==e?b=e:null!==b&&null!==e&&(b=ol.extent.extend(b,e))},this),b}return Item.getLayerExtent(this.layer)},Item.getIcon=function(b){return b===a.item.Type.GROUP?a.item.icons.group:b===a.item.Type.HEATMAP?a.item.icons.heatmap:b===a.item.Type.IMAGE?a.item.icons.image:b===a.item.Type.OVERLAY?a.item.icons.overlay:b===a.item.Type.TILE?a.item.icons.tile:b===a.item.Type.VECTOR?a.item.icons.vector:"icon-page"},Item.getLayerExtent=function(a){var b=a.getExtent();if("undefined"==typeof b){var c=a.getSource();null!==c&&(c instanceof ol.source.Cluster||c instanceof ol.source.VectorTile||c instanceof ol.source.Vector)&&(b=c.getExtent())}return"undefined"==typeof b?null:b},Item.prototype.getPropertyTypes=function(){return this.layer instanceof ol.layer.Layer?a.item.LayerProperties:this.layer instanceof ol.Overlay?a.item.OverlayProperties:{}},Item.prototype.getProperties=function(){var a={name:this.name},b=this.getPropertyTypes();for(var c in b)a[c]=this.layer.get(c);return a},Item.getType=function(b){return b instanceof ol.layer.Group?a.item.Type.GROUP:b instanceof ol.layer.Heatmap?a.item.Type.HEATMAP:b instanceof ol.layer.Image?a.item.Type.IMAGE:b instanceof ol.layer.Tile?a.item.Type.TILE:b instanceof ol.layer.Vector?a.item.Type.VECTOR:b instanceof ol.Overlay?a.item.Type.OVERLAY:null},Item.prototype.setProperties=function(a){a.hasOwnProperty("name")&&(this.name=a.name);var b=this.getPropertyTypes();for(var c in b)a.hasOwnProperty(c)&&this.layer.set(c,a[c])},Item.prototype.property=function(a,b){return"undefined"!=typeof this[a]?("undefined"!=typeof b&&(this[a]=b),this[a]):void 0},Item.prototype.zoomTo=function(b){var c=b.getView();if(this.type===a.item.Type.OVERLAY){var d=this.layer.getPosition();if("undefined"!=typeof d)return void c.setCenter(d);w2alert("Overlay has no position defined to which to zoom.","Warning")}else{var e=this.getExtent();if(null!==e)return void c.fit(e,b.getSize());w2alert("Layer has no extent defined to which to zoom.","Warning")}},a.item.Item=function(a,b,c){var d=new Item(a,b,c);return{getDetails:d.getDetails.bind(d),getProperties:d.getProperties.bind(d),getPropertyTypes:d.getPropertyTypes.bind(d),icon:d.icon,id:d.id,layer:d.layer,moving:function(a){return d.property("moving",a)},name:function(a){return d.property("name",a)},setProperties:d.setProperties.bind(d),type:d.type,zoomTo:d.zoomTo.bind(d)}},a.item.OverlayProperties={},a.item.LayerProperties={opacity:{title:"Opacity"}},a.item.Type={GROUP:0,HEATMAP:1,IMAGE:2,OVERLAY:3,TILE:4,VECTOR:5},a}(olexp||{}),olexp.manager=olexp.manager||{},function(a){var b=function(b,c,d,e,f){this.count=0,this.details=d,this.event=new a.event.Event({"select:item":[]}),this.items=[],this.managerLayers=new a.manager.NodeManager(e,b.getLayers(),c,d),this.layersId=e,this.managerOverlays=new a.manager.NodeManager(f,b.getOverlays(),c,d),this.map=b,this.map.on("change:layergroup",this.onLayerGroupChanged,this),this.outline=c,this.overlaysId=f};return b.prototype.isIdLayerNode=function(a){return"string"!=typeof a?!1:0===a.indexOf(this.layersId)},b.prototype.isIdOverlayNode=function(a){return"string"!=typeof a?!1:0===a.indexOf(this.overlaysId)},b.prototype.isSelected=function(a){return a===this.outline.selected},b.prototype.getById=function(a){return this.isIdLayerNode(a)?this.managerLayers.getById(a):this.isIdOverlayNode(a)?this.managerOverlays.getById(a):null},b.prototype.getDetails=function(a){if(this.isIdLayerNode(a)){var b=this.managerLayers.getById(a);if(null!==b)return b.getDetails()}else if(this.isIdOverlayNode(a)){var c=this.managerOverlays.getById(a);if(null!==c)return c.getDetails()}return[]},b.prototype.getNode=function(a){return this.outline.get(a)},b.prototype.moveDown=function(a){return"undefined"==typeof a&&(a=this.outline.selected),this.isIdLayerNode(a)?this.managerLayers.moveDown(a):this.isIdOverlayNode(a)?this.managerOverlays.moveDown(a):!1},b.prototype.moveUp=function(a){return"undefined"==typeof a&&(a=this.outline.selected),this.isIdLayerNode(a)?this.managerLayers.moveUp(a):this.isIdOverlayNode(a)?this.managerOverlays.moveUp(a):!1},b.prototype.off=function(a,b,c){this.event.off(a,b,c),this.managerLayers.off(a,b,c),this.managerOverlays.off(a,b,c)},b.prototype.on=function(a,b,c){this.event.on(a,b,c),this.managerLayers.on(a,b,c),this.managerOverlays.on(a,b,c)},b.prototype.onItemSelected=function(a){this.event.trigger("select:item",a)},b.prototype.onLayerGroupChanged=function(a){this.managerLayers.setLayers(a.target.getLayers())},b.prototype.removeFromMap=function(a){return a.hasOwnProperty("id")?this.isIdLayerNode(a.id)?this.managerLayers.removeFromMap(a):this.isIdOverlayNode(a.id)?this.managerOverlays.removeFromMap(a):null:null},b.prototype.toggleNode=function(a){if("string"==typeof a){var b=this.outline.get(a),c=b.disabled;if(c?this.outline.enable(a):this.outline.disable(a),this.isIdLayerNode(a)){var d=this.managerLayers.getById(a);null!==d&&d.layer.setVisible(c)}else if(this.isIdOverlayNode(a)){var e=this.managerOverlays.getById(a);if(null!==e){var f=e.layer.getProperties();if(f.hasOwnProperty("element")){var g=$(f.element);c?g.show():g.hide()}}}}},b.prototype.updateItem=function(a,b){var c=this.getById(a);if(null!==c){c.setProperties(b);var d=this.outline.get(a);d.text=c.name(),this.outline.refresh()}},b.prototype.zoomTo=function(a){var b=this.getById(a);b.zoomTo(this.map)},a.manager.Manager=function(a,c,d,e,f){var g=new b(a,c,d,e,f);return{getById:g.getById.bind(g),getDetails:g.getDetails.bind(g),getNode:g.getNode.bind(g),isSelected:g.isSelected.bind(g),moveDown:g.moveDown.bind(g),moveUp:g.moveUp.bind(g),off:g.off.bind(g),on:g.on.bind(g),onItemSelected:g.onItemSelected.bind(g),removeFromMap:g.removeFromMap.bind(g),toggleNode:g.toggleNode.bind(g),updateItem:g.updateItem.bind(g),zoomTo:g.zoomTo.bind(g)}},a}(olexp||{}),function(a){var b=function(b,c,d,e){this.count=0,this.details=e,this.event=new a.event.Event({"remove:item":[]}),this.id=b,this.items=[],this.layers=c,this.layers.on("change:length",this.onLayerChanged,this),this.managers={},this.outline=d};return b.prototype.addLayer=function(c){this.count+=1;var d=this.id+"-"+this.count,e="Item "+this.count,f=c.getProperties();f.hasOwnProperty("name")&&(e=f.name);var g=new a.item.Item(d,e,c);this.items.push(g);var h={id:g.id,img:g.icon,text:g.name()},i=this.outline.get(this.id).nodes;if(0===i.length?this.outline.add(this.id,[h]):this.outline.insert(this.id,i[0].id,[h]),g.type===a.item.Type.GROUP){var j=c.getLayers(),k=new b(g.id,j,this.outline,this.details);j.forEach(function(a){k.addLayer(a)},this),this.managers[g.id]=k,this.outline.expand(g.id)}return g},b.prototype.getById=function(b,c){"undefined"==typeof c&&(c=!0);for(var d=this.getSize(),e=0;d>e;e++){if(this.items[e].id===b)return this.items[e];if(this.items[e].type===a.item.Type.GROUP&&c){var f=this.managers[this.items[e].id].getById(b);if(null===f)continue;if(f.id===b)return f}}return null},b.prototype.getByLayer=function(b,c){"undefined"==typeof c&&(c=!0);for(var d=this.getSize(),e=0;d>e;e++){if(this.items[e].layer===b)return this.items[e];if(this.items[e].type===a.item.Type.GROUP&&c){var f=this.managers[this.items[e].id].getByLayer(b);if(null===f)continue;if(f.layer===b)return f}}return null},b.prototype.getSize=function(){return this.items.length},b.prototype.isSelected=function(a){return a===this.outline.selected},b.prototype.isHidden=function(b){return b instanceof a.measure.Overlay},b.prototype.moveDown=function(b){var c=this.getById(b,!1);if(null!==c){var d=this.moveLayerUp(this.layers,c.layer);return d&&(d=this.moveItemDown(b)),d}for(var e=this.getSize(),f=0;e>f;f++)if(this.items[f].type===a.item.Type.GROUP){var g=this.managers[this.items[f].id].moveDown(b);if(null!==g)return g}return null},b.prototype.moveItemDown=function(a){var b=this.outline.get(a);if(null===b)return!1;var c=this.outline.find(b.parent.id,{parent:b.parent}),d=this.outline.get(b.parent.id,a,!0);if(d>=c.length-1)return!1;var e=c[d+1].id,f=c[d+1];return b.parent!==f.parent?!1:(this.outline.remove(e),this.outline.insert(b.parent,a,f),this.outline.select(a),!0)},b.prototype.moveItemUp=function(a){var b=this.outline.get(a);if(null===b)return!1;var c=this.outline.find(b.parent.id,{parent:b.parent}),d=this.outline.get(b.parent.id,a,!0);if(0>=d)return!1;var e=c[d-1].id,f=c[d-1];return b.parent!==f.parent?!1:(this.outline.remove(a),this.outline.insert(b.parent,e,b),this.outline.select(a),!0)},b.prototype.moveLayerDown=function(b,c){var d=a.util.indexOf(b,c),e=this.layers.getLength();if(e-1>d){var f=this.getByLayer(c,!1);return f.moving(!0),b.removeAt(d),b.insertAt(d+1,c),f.moving(!1),!0}return!1},b.prototype.moveLayerUp=function(b,c){var d=a.util.indexOf(b,c);if(d>0){var e=this.getByLayer(c,!1);return e.moving(!0),b.removeAt(d),b.insertAt(d-1,c),e.moving(!1),!0}return!1},b.prototype.moveUp=function(b){var c=this.getById(b,!1);if(null!==c){var d=this.moveLayerDown(this.layers,c.layer);
return d&&(d=this.moveItemUp(b)),d}for(var e=this.getSize(),f=0;e>f;f++)if(this.items[f].type===a.item.Type.GROUP){var g=this.managers[this.items[f].id].moveUp(b);if(null!==g)return g}return null},b.prototype.off=function(b,c,d){this.event.off(b,c,d);for(var e=this.getSize(),f=0;e>f;f++)this.items[f].type===a.item.Type.GROUP&&this.managers[this.items[f].id].off(b,c,d)},b.prototype.on=function(b,c,d){this.event.on(b,c,d);for(var e=this.getSize(),f=0;e>f;f++)this.items[f].type===a.item.Type.GROUP&&this.managers[this.items[f].id].on(b,c,d)},b.prototype.onItemRemoved=function(a){this.event.trigger("remove:item",a),this.isSelected(a.id)&&this.details.clear(),this.remove(a)},b.prototype.onLayerChanged=function(b){for(var c=b.target,d=c.getLength(),e=0;d>e;e++){var f=c.item(e);if(!this.isHidden(f)){var g=this.getByLayer(f);null===g&&this.addLayer(f)}}for(var h=this.toList(),i=h.length,j=0;i>j;j++){var k=h[j];if(!k.moving()){var l=a.util.indexOf(this.layers,k.layer);-1===l&&this.onItemRemoved(k)}}},b.prototype.remove=function(b){var c=this.items.indexOf(b);if(-1!==c)return this.items.splice(c,1),this.outline.remove(b.id),!0;for(var d=this.getSize(),e=0;d>e;e++)if(this.items[e].type===a.item.Type.GROUP){var f=this.managers[this.items[e].id].remove(id);if(f)return!0}return!1},b.prototype.removeFromMap=function(b){var c=this.layers.remove(b.layer);if("undefined"!=typeof c)return c;for(var d=this.getSize(),e=0;d>e;e++)if(this.items[e].type===a.item.Type.GROUP){var f=this.managers[this.items[e].id].removeFromMap(b);if(null!==f)return f}return null},b.prototype.setLayers=function(a){for(this.layers.un("change:length",this.onLayerChanged,this);this.items.length>0;)this.onItemRemoved(this.items[this.items.length-1]);this.layers=a,this.layers.on("change:length",this.onLayerChanged,this);for(var b=0;b<this.layers.getLength();b++)this.addLayer(this.layers.item(b))},b.prototype.toList=function(){for(var a=[],b=this.getSize(),c=0;b>c;c++)a.push(this.items[c]);return a},a.manager.NodeManager=function(a,c,d,e){var f=new b(a,c,d,e);return{getById:f.getById.bind(f),getByLayer:f.getByLayer.bind(f),moveDown:f.moveDown.bind(f),moveUp:f.moveUp.bind(f),off:f.off.bind(f),on:f.on.bind(f),removeFromMap:f.removeFromMap.bind(f),setLayers:f.setLayers.bind(f)}},a}(olexp||{}),olexp.measure=olexp.measure||{},function(a){a.measure.properties={area:"olexp-measure-property-area",length:"olexp-measure-property-length"};var b=function(a){ol.Overlay.call(this,a)};b.prototype=Object.create(ol.Overlay.prototype);var c=function(a,b,c){var d=$.extend(!0,{measure:{Tool:{continueLineMsg:"Click to continue drawing the line",continuePolygonMsg:"Click to continue drawing the polygon",helpTooltipOffset:[20,0],helpTooltipPositioning:"center-left",measuredStyle:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"#ffcc33",width:2}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#ffcc33"})})}),measuringStyle:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"rgba(0, 0, 0, 0.5)",lineDash:[10,10],width:2}),image:new ol.style.Circle({radius:5,stroke:new ol.style.Stroke({color:"rgba(0, 0, 0, 0.7)"}),fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"})})}),measureTooltipOffset:[0,-20],measureTooltipPositioning:"bottom-center",messageStart:"Click to start drawing. Double click to stop."}}},c);this.settings=d.measure.Tool,this.continueLineMsg=this.settings.continueLineMsg,this.continuePolygonMsg=this.settings.continuePolygonMsg,this.count=0,this.draw=null,this.drawing=!1,this.geodesic=!1,this.helpTooltip=null,this.helpTooltipElement=null,this.map=a,this.measureTooltip=null,this.measureTooltipElement=null,this.pointerMoveCallback=this.onPointerMove.bind(this),this.sketch=null,this.source=null,this.sphere=new ol.Sphere(6378137),this.type=b,this.vector=null};return c.prototype.createHelpTooltip=function(){this.helpTooltipElement&&this.helpTooltipElement.parentNode.removeChild(this.helpTooltipElement),this.helpTooltipElement=document.createElement("div"),this.helpTooltipElement.className="olexp-measure olexp-measure-hidden",this.helpTooltip=new a.measure.Overlay({element:this.helpTooltipElement,offset:this.settings.helpTooltipOffset,positioning:this.settings.helpTooltipPositioning}),this.map.addOverlay(this.helpTooltip)},c.prototype.createMeasureVector=function(){this.vector=new ol.layer.Vector({source:this.source,style:this.settings.measuredStyle}),this.vector.set("name","Measurement #"+(this.count+1)),this.map.addLayer(this.vector)},c.prototype.createMeasureTooltip=function(){this.measureTooltipElement&&this.measureTooltipElement.parentNode.removeChild(this.measureTooltipElement),this.measureTooltipElement=document.createElement("div"),this.measureTooltipElement.className="olexp-measure olexp-measure-active",this.measureTooltip=new a.measure.Overlay({element:this.measureTooltipElement,offset:this.settings.measureTooltipOffset,positioning:this.settings.measureTooltipPositioning}),this.measureTooltip.set("name","Measurement #"+(this.count+1)),this.map.addOverlay(this.measureTooltip)},c.prototype.formatArea=function(a){var b=0;if(this.geodesic){var c=this.map.getView().getProjection(),d=a.clone().transform(c,"EPSG:4326"),e=d.getLinearRing(0).getCoordinates();b=Math.abs(this.sphere.geodesicArea(e))}else b=a.getArea();var f="";return f=b>1e4?Math.round(b/1e6*100)/100+" km<sup>2</sup>":Math.round(100*b)/100+" m<sup>2</sup>"},c.prototype.formatLength=function(a){var b=0;if(this.geodesic)for(var c=this.map.getView().getProjection(),d=a.getCoordinates(),e=d.length,f=0;e-1>f;++f){var g=ol.proj.transform(d[f],c,"EPSG:4326"),h=ol.proj.transform(d[f+1],c,"EPSG:4326");b+=this.sphere.haversineDistance(g,h)}else b=Math.round(100*a.getLength())/100;var i;return i=b>100?Math.round(b/1e3*100)/100+" km":Math.round(100*b)/100+" m"},c.prototype.onPointerMove=function(a){if(!a.dragging){var b=this.settings.messageStart;if(this.sketch){var c=this.sketch.getGeometry();c instanceof ol.geom.Polygon?b=this.continuePolygonMsg:c instanceof ol.geom.LineString&&(b=this.continueLineMsg)}this.helpTooltipElement.innerHTML=b,this.helpTooltip.setPosition(a.coordinate),$(this.helpTooltipElement).removeClass("olexp-measure-hidden")}},c.prototype.setEnable=function(a){a?this.map.on("pointermove",this.pointerMoveCallback):this.map.un("pointermove",this.pointerMoveCallback),this.setInteraction(a)},c.prototype.setInteraction=function(b){"undefined"==typeof b&&(b=!0);var c=this;if(this.draw&&this.map.removeInteraction(this.draw),!b)return $(this.helpTooltipElement).addClass("olexp-measure-hidden"),void(this.drawing&&(this.map.removeLayer(this.vector),this.vector=null,this.measureTooltipElement.parentNode.removeChild(this.measureTooltipElement),this.measureTooltipElement=null,this.drawing=!1));$(this.helpTooltipElement).removeClass("olexp-measure-hidden"),this.source=new ol.source.Vector,this.draw=new ol.interaction.Draw({source:this.source,type:this.type,style:this.settings.measuringStyle}),this.map.addInteraction(this.draw),this.createMeasureTooltip(),this.createHelpTooltip();var d=null;this.draw.on("drawstart",function(a){this.drawing=!0,c.createMeasureVector();var b=a.coordinate;c.sketch=a.feature,d=c.sketch.getGeometry().on("change",function(a){var d="",e=a.target;e instanceof ol.geom.Polygon?(d=c.formatArea(e),b=e.getInteriorPoint().getCoordinates()):e instanceof ol.geom.LineString&&(d=c.formatLength(e),b=e.getLastCoordinate()),c.measureTooltipElement.innerHTML=d,c.measureTooltip.setPosition(b)})},this),this.draw.on("drawend",function(b){this.drawing=!1,c.count+=1;var e=c.sketch.getGeometry(),f={};e instanceof ol.geom.Polygon?(f[a.measure.properties.area]=c.formatArea(e),c.vector.setProperties(f)):e instanceof ol.geom.LineString&&(f[a.measure.properties.length]=c.formatLength(e),c.vector.setProperties(f)),c.sketch=null,c.measureTooltipElement.parentNode.removeChild(c.measureTooltipElement),c.measureTooltipElement=null,c.createMeasureTooltip(),ol.Observable.unByKey(d),c.setInteraction(!0)},this)},c.prototype.setType=function(a){this.type=a},a.measure.Tool=function(b,d){"undefined"==typeof d&&(d={}),"undefined"==typeof d.type&&(d.type=a.measure.Type.LINE),"undefined"==typeof d.settings&&(d.settings={});var e=new c(b,d.type,d.settings);return{setEnable:function(a){e.setEnable(a)},setType:function(a){e.setType(a)}}},a.measure.Type={AREA:"Polygon",LINE:"LineString"},a.measure.Overlay=b,a}(olexp||{}),olexp.menu=olexp.menu||{},function(a){var b=function(a,b){var c=$.extend(!0,{menu:{Properties:{field:35,form:{},popup:{height:125,style:"width: 100%; height: 100%;",title:"Edit Layer",width:300},span:4,text:"Properties"}}},b);this.icon="olexp-menu-properties",this.form=b.prefix+"-menu-properties-form",this.id=b.prefix+"-menu-properties",this.manager=a,this.name="layerform",this.settings=c.menu.Properties};return b.prototype.onClick=function(b){var c=this,d=b.target,e=this.manager.getById(d),f=e.getProperties(),g=this.settings.popup.height,h=this.settings.field,i=[];g+=h,i.push({field:"name",html:{caption:"Name",span:this.settings.span},required:!0,type:"text"});for(var j=e.getPropertyTypes(),k=$.map(j,function(a){return a.title}),l=0;l<k.length;l++)g+=h,i.push({field:k[l].toLowerCase(),html:{caption:k[l],span:this.settings.span},required:!0,type:"float"});var m=function(a){c.manager.updateItem(d,a)},n=$.extend(this.settings.form,{fields:i,name:this.name,record:f}),o=$.extend($.extend({},this.settings.popup),{height:g});a.util.popup(this.form,m,n,o)},a.menu.Properties=function(a,c){var d=new b(a,c);return{menu:{id:d.id,img:d.icon,text:d.settings.text},click:function(a){d.onClick(a)}}},a}(olexp||{}),function(a){var b=function(a,b){var c=$.extend(!0,{menu:{Remove:{text:"Remove"}}},b);this.icon="olexp-menu-remove",this.id=b.prefix+"-menu-remove",this.manager=a,this.settings=c.menu.Remove};return b.prototype.onClick=function(a){var b=this,c=a.target,d=this.manager.getById(c);w2confirm('Do you want to delete "'+d.name()+'"?').yes(function(){b.manager.removeFromMap(d)})},a.menu.Remove=function(a,c){var d=new b(a,c);return{menu:{id:d.id,img:d.icon,text:d.settings.text},click:function(a){d.onClick(a)}}},a}(olexp||{}),function(a){var b=function(a,b){var c=$.extend(!0,{menu:{Zoom:{text:"Zoom"}}},b);this.icon="olexp-menu-zoom",this.id=b.prefix+"-menu-zoom",this.manager=a,this.settings=c.menu.Zoom};return b.prototype.onClick=function(a){var b=a.target;this.manager.zoomTo(b)},a.menu.Zoom=function(a,c){var d=new b(a,c);return{menu:{id:d.id,img:d.icon,text:d.settings.text},click:function(a){d.onClick(a)}}},a}(olexp||{}),olexp.ol=olexp.ol||{},function(a){var b=function(a,b){var c=$.extend(!0,{ol:{ToolbarShow:{html:"T",title:"Show toolbar"}}},b);this.settings=c.ol.ToolbarShow,this.explorer=a;var d=document.createElement("button");d.innerHTML=this.settings.html,d.title=this.settings.title,d.addEventListener("click",this.show.bind(this),!1),d.addEventListener("touchstart",this.show.bind(this),!1);var e=document.createElement("div");e.id=b.prefix+"-ol-toolbar-show",e.className="olexp-ol-toolbar-show ol-unselectable ol-control",e.appendChild(d),ol.control.Control.call(this,{element:e})};return ol.inherits(b,ol.control.Control),b.prototype.show=function(){this.explorer.layout.show(this.explorer.options.toolbar.type),this.setMap(null)},a.ol.ToolbarShow=function(a,c){var d=$.extend({hidden:!1},c),e=new b(a,d.settings);return d.hidden&&e.setMap(a.map),e},a}(olexp||{}),olexp.selection=olexp.selection||{},function(a){var b=function(b,c){this.details=c,this.interaction=new ol.interaction.Select,this.map=b;var d=this;this.interaction.on("select",function(b){if(1===b.selected.length){var c=b.selected[0],e=a.util.toProperties(c);for(var f in e)"boolean"!=typeof e[f]&&"number"!=typeof e[f]&&"string"!=typeof e[f]&&delete e[f];var g=a.util.toRecords(e);d.details.clear(),d.details.add(g)}})};return b.prototype.setEnable=function(a){a?this.map.addInteraction(this.interaction):this.map.removeInteraction(this.interaction)},a.selection.Feature=function(a,c){var d=new b(a,c);return{setEnable:function(a){d.setEnable(a)}}},a}(olexp||{}),olexp.util=olexp.util||{},function(a){return Util=function(a){var b=$.extend(!0,{util:{Util:{Cluster:function(a){return style=[new ol.style.Style({image:new ol.style.Circle({radius:10,stroke:new ol.style.Stroke({color:"#ffffff"}),fill:new ol.style.Fill({color:"#3399CC"})}),text:new ol.style.Text({text:a.toString(),fill:new ol.style.Fill({color:"#ffffff"})})})],style},Point:[new ol.style.Style({image:new ol.style.Circle({fill:new ol.style.Fill({color:"rgba(255,255,0,0.5)"}),radius:5,stroke:new ol.style.Stroke({color:"#ff0",width:1})})})],LineString:[new ol.style.Style({stroke:new ol.style.Stroke({color:"#f00",width:3})})],Polygon:[new ol.style.Style({fill:new ol.style.Fill({color:"rgba(0,255,255,0.5)"}),stroke:new ol.style.Stroke({color:"#0ff",width:1})})],MultiPoint:[new ol.style.Style({image:new ol.style.Circle({fill:new ol.style.Fill({color:"rgba(255,0,255,0.5)"}),radius:5,stroke:new ol.style.Stroke({color:"#f0f",width:1})})})],MultiLineString:[new ol.style.Style({stroke:new ol.style.Stroke({color:"#0f0",width:3})})],MultiPolygon:[new ol.style.Style({fill:new ol.style.Fill({color:"rgba(0,0,255,0.5)"}),stroke:new ol.style.Stroke({color:"#00f",width:1})})]}}},a);this.settings=b.util.Util,this.defaultStyle={Point:this.settings.Point,LineString:this.settings.LineString,Polygon:this.settings.Polygon,MultiPoint:this.settings.MultiPoint,MultiLineString:this.settings.MultiLineString,MultiPolygon:this.settings.MultiPolygon},this.clusterStyleCache={}},Util.prototype.addLayerVector=function(a,b,c,d){"undefined"==typeof d&&(d=!0);for(var e=this,f=0;f<c.length;f++){var g=c[f].getGeometry();if("undefined"==typeof g||"Point"!==g.getType()){d=!1;break}}var h=new ol.source.Vector({features:c});d&&(h=new ol.source.Cluster({source:h}));var i=function(a,b){var c=a.getStyleFunction();return c?c.call(a,b):e.defaultStyle[a.getGeometry().getType()]};d&&(i=function(a,b){return e.getClusterStyle(a)});var j=new ol.layer.Vector({source:h,style:i});j.set("name",b),a.getLayers().push(j)},Util.prototype.getClusterStyle=function(a){var b=a.get("features").length,c=this.clusterStyleCache[b];return c||(c=this.settings.Cluster(b),this.clusterStyleCache[b]=c),c},Util.prototype.getControls=function(){var a={fullscreen:new ol.control.FullScreen,mouseposition:new ol.control.MousePosition({coordinateFormat:ol.coordinate.createStringXY(6),projection:"EPSG:4326"}),overviewmap:new ol.control.OverviewMap,rotate:new ol.control.Rotate,scaleline:new ol.control.ScaleLine,zoom:new ol.control.Zoom,zoomslider:new ol.control.ZoomSlider,zoomtoextent:new ol.control.ZoomToExtent};return a},Util.prototype.getDragAndDrop=function(b){var c=this,d=new ol.interaction.DragAndDrop({formatConstructors:$.map(a.util.FileTypes,function(a){return a.format})});return d.on("addfeatures",function(a){var d=a.file.name.replace(/\.[^\/.]+$/,"");c.addLayerVector(b,d,a.features)}),d},Util.prototype.getGraticule=function(a,b){var c=$.extend($.extend({},b),{color:"#"+b.color}),d=new ol.Graticule({map:a,strokeStyle:new ol.style.Stroke(c)});return d.olexp_record=$.extend({enable:null!==a},b),d},Util.prototype.getInteractions=function(a){var b={draganddrop:this.getDragAndDrop(a)};return b},Util.prototype.getTileTypes=function(){var a={},b="Ak-dzM4wZjSqTlzveKz5u0d4IQ4bRzVI309GxmkgSVr1ewS6iPSrOvOKhA-CJlm3",c=19;return a.bingAerial={"class":ol.source.BingMaps,name:"Bing Maps (Aerial)",settings:{imagerySet:"Aerial",key:b,maxZoom:c}},a.bingAerialLabels={"class":ol.source.BingMaps,name:"Bing Maps (Aerial with Labels)",settings:{imagerySet:"AerialWithLabels",key:b,maxZoom:c}},a.bingRoad={"class":ol.source.BingMaps,name:"Bing Maps (Road)",settings:{imagerySet:"Road",key:b,maxZoom:c}},a.mapQuestAerial={"class":ol.source.MapQuest,name:"Map Quest (Aerial)",settings:{layer:"sat"}},a.mapQuestAerialLabels={"class":ol.source.MapQuest,name:"Map Quest (Labels)",settings:{layer:"hyb"}},a.mapQuestRoad={"class":ol.source.MapQuest,name:"Map Quest (Road)",settings:{layer:"osm"}},a.osm={"class":ol.source.OSM,name:"OpenStreetMap",settings:{}},a.stamenTerrain={"class":ol.source.Stamen,name:"Stamen (Terrain)",settings:{layer:"terrain"}},a.stamenToner={"class":ol.source.Stamen,name:"Stamen (Toner)",settings:{layer:"toner"}},a.stamenWater={"class":ol.source.Stamen,name:"Stamen (Water Color)",settings:{layer:"watercolor"}},a},a.util.FileTypes={gpx:{extensions:["gpx"],format:ol.format.GPX,name:"GPX"},igc:{extensions:["igc"],format:ol.format.IGC,name:"IGC"},json:{extensions:["json","geojson"],format:ol.format.GeoJSON,name:"GeoJSON"},kml:{extensions:["kml"],format:ol.format.KML,name:"KML"}},a.util.getReader=function(b){for(var c=b.substring(b.lastIndexOf(".")+1).toLowerCase(),d=Object.keys(a.util.FileTypes),e=0;e<d.length;e++)for(var f=a.util.FileTypes[d[e]],g=f.extensions,h=0;h<g.length;h++)if(c===g[h])return new f.format;return null},a.util.indexOf=function(a,b){for(var c=a.getLength(),d=0;c>d;d++)if(b===a.item(d))return d;return-1},a.util.popup=function(a,b,c,d){var e=c.name,f=c.record;w2ui.hasOwnProperty(e)&&w2ui[e].destroy(),$().w2form($.extend(c,{actions:{save:function(){var a=this.validate();if(0===a.length){w2popup.close();var c=w2ui[e],d=c.getChanges();b(d)}},reset:function(){var a=w2ui[e];for(var b in f)a.record[b]=f[b];a.refresh()}}})),w2popup.open($.extend(d,{body:'<div id="'+a+'"></div>',onOpen:function(b){b.onComplete=function(){$("#w2ui-popup #"+a).w2render(e)}},onToggle:function(a){var b=w2ui[e];$(b.box).hide(),a.onComplete=function(){$(b.box).show(),b.resize()}}}))},a.util.toProperties=function(a){var b=a.getProperties();if(b.hasOwnProperty("features")){var c=b.features;if(c instanceof Array)if(1===c.length)c[0]instanceof ol.Feature&&(b=c[0].getProperties());else for(var d=0,e=0;e<c.length;e++)c[e]instanceof ol.Feature&&(d+=1,b["Cluster Size"]=d)}return b},a.util.toRecords=function(a){var b=[],c=0;for(var d in a){var e=a[d];c+=1,b.push({recid:c,property:d,value:e})}return b},a.util.Util=function(a){var b=new Util(a);return{addLayerVector:b.addLayerVector.bind(b),getControls:b.getControls.bind(b),getGraticule:b.getGraticule.bind(b),getInteractions:b.getInteractions.bind(b),getTileTypes:b.getTileTypes.bind(b)}},a}(olexp||{});